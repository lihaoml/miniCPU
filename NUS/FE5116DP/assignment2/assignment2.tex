\documentclass[11pt,a4paper,hidelinks,fleqn]{article}            % Article 12pt font for a4 paper while hiding links
\usepackage[margin=1in]{geometry}                          % Required to adjust margins
\usepackage{ulem}

\input{styleAndCommands}
\title{\vspace{-5ex}FE5116DP Assignment 2\vspace{-7ex}}
\date{}
\begin{document}
\maketitle
\subsection*{Assignment 2.1}
This excercise considers options on stock paying continuous dividend rates \verb=q=. 
\vspace{-1cm}
\paragraph{a)} Implement a function 
\vspace{-5mm}
\begin{verbatim}
europeanStraddleBinomialPricerD(spot, sigma, rf, T, N, strke, q)
\end{verbatim}
\vspace{-5mm}
that prices European straddle (a straddle option pays off $\max(spot-strike, strike-spot)$) on this stock using CRR binomial tree.
Unlike the European payoff example code given in the lecture notes that uses only the last time step of the tree, 
you are required to calculate the price backward in the tree despite it is computationally more expensive. 
You can use the American put option example pricer as reference for backward pricing, introducing of course the necessary modification to account for the fact that the option is European.  
Note that the parameters of the CRR tree should be computed inside the function.

The risk free rate \verb=rf= and the dividend yield \verb=q= are constant.
\verb=N= is the number of time steps of the binomial tree.

\paragraph{b)} For \verb_sigma = 20%, rf = 4%, q = 5%_, 
price a European straddle with strike = $100$ and \verb_T=2_ for different spots: [50, 51, ..., 150].
For N = 10, 50, 100, 200 respectively, plot the binomial tree option price versus the spot (one chart for each N) and overlay the plot with analytic prices as reference.

The analytic formula for European straddle option on continuous dividend paying stock is the sum of European call option and European put option:
\begin{align*}
 & Call(S, K, \sigma, T) = e^{-rT} (F N(d_+) - K N(d_-)) \\
 & Put(S, K, \sigma, T) = e^{-rT} ( K N(\textbf{\textcolor{red}{$-$}}d_-) - F N(\textbf{\textcolor{red}{$-$}}d_-) d_+))
\end{align*}
where $S$ is the spot price, $K$ is the strike, and $N(\cdot)$ is the standard cumulative normal function, and
\begin{align*}
F = S e^{(r-q)T}, ~~
d_{\pm} = \frac{ln\frac{F}{K}  \pm \frac{1}{2}\sigma^2T}{\sigma\sqrt{T}}.
\end{align*}

\paragraph{c)} Extend the function in a) to 
\vspace{-5mm}
\begin{verbatim}
americanStraddleBinomialPricerD(spot, sigma, rf, T, N, strike, q)
\end{verbatim}
\vspace{-5mm}
that prices American style straddle options where the payoff can be exercised any time before expiry. 

\sout{\textcolor{red}{Plot the prices for American call option strike at 85 for N from 10 to 200, and overlay the plot with the plot generated in a).}}

\paragraph{d)} Generate the same test result and plots as b) for American straddle, except the analytic prices which is only for European style options.

\subsection*{Assignment 2.2}
We consider pricing a ``best of two'' option using Monte-Carlo.
A BestOf option pays off $\max(p_a(S_a), p_b(S_b))$ at expiry date
where $S_a$ and $S_b$ are two underlying stocks, 
$p_a(.)$ and $p_b(.)$ are the payoff functions of the two legs.

To price the option with Monte Carlo, one would need to simulate $S_a$ and $S_b$.
Consider the below risk-neutral diffusion:
\begin{align}
& dS_a(t) / S_a(t) = (r-r_a) dt + \sigma_a dW_a \\
& dS_b(t) / S_b(t) = (r-r_b) dt + \sigma_b dW_b \\
& dW_a dW_b = \rho dt
\end{align}
where $r$ is the risk free interest rate, 
$r_a$ is the continuous yield of the stock $S_a$, 
$r_b$ is the continuous yield of the stock $S_b$, 
and $\rho \in [-1, 1]$ is the correlation between the two stock prices.
Implement a Monte Carlo pricer to price the BestOf option
\begin{verbatim}
BestOfMC(r, r_a, r_b, sigma_a, sigma_b, rho, s_a0, s_b0, T, p_a, p_b, nPath)
\end{verbatim}
where \verb=s_a0= and \verb=s_b0= are the current stock prices $S_a(0)$ and $S_b(0)$, and \verb=nPath= the number of paths of the MC simulation. 

For
\begin{verbatim}
r = 5%, r_a = 6%, r_b = 3%,
sigma_a = 22%, sigma_b = 15%, rho = 50%,
s_a0 = 100, s_b0 = 95,
p_a = s_a - 90,
p_b = s_b - 88,
\end{verbatim}
price the BestOf option for nPath = $2^i$, $i \in \{14, 15, 16, 17, 18, 19, 20\}$. Plot the chart of option prices versus number of paths.

(Note: to verify the correctness of the BestOf MC pricer, you can create a degenerate case where the two legs are identically a call option of the same stock.
That is, \verb|s_a = s_b = s| and \verb|p_a = p_b = s - k|. In this case the option degenerates to a plain vanilla call option because both legs are identical.
You can then compare with the analytic price of a call option. 
Alternatively, we can consider the BestOf two assets options where \verb|p_a = s_a| and \verb|p_b = s_b|, whose analytic formula is known as
\begin{align*}
e^{-r_aT}S_{a}(0)N(d_1) + e^{-r_bT}S_{b}(0)(1 - N(d_2))
\end{align*}
where 
\begin{align*}
d_1 & = \frac{\ln{\frac{S_a(0)}{S_b(0)}} + r_b - r_a + \frac{\sigma^2}{2}T}{\sigma\sqrt{T}} \\
d_2 & = d_1 - \sigma \sqrt{T} \\
\sigma & = \sqrt{\sigma_a^2 + \sigma_b^2 - 2 \rho \sigma_a \sigma_b}
\end{align*}
Note that the verification is not required to be submitted.)

\subsection*{Assignment 2.3}
Let us price derivatives with PDE for the one factor mean reverting model (MR1) that was introduced in the Monte-Carlo lecture. 
Recall the model diffusion:
\begin{align*}
\frac{dF(t, T)}{F(t, T)} = \sigma e^{-\alpha (T- t)} dW_t,
\end{align*}
our choice of state variable is
\begin{align}
dZ_t = -\alpha Z_t dt + dW_t,
\end{align}
and the reconstruction for the futures prices is:
\begin{align}
F(t, T) & = F(0, T) \exp\left( -\frac{\sigma^2}{2} \int_0^t e^{-2\alpha (T - u)} du + \sigma e^{-\alpha(T-t)} Z_t \right)
%        & = F(0, T) \exp\left( \frac{\sigma^2}{4\alpha} e^{-2\alpha T} \left(1 - e^{2\alpha t}\right) + \sigma e^{-\alpha(T-t)} Z_t \right).
\label{eq:mr1_reconstruction}
\end{align}
A derivative contract contingent on the value of $F(t, T)$ can be expressed as a derivative on the state variable $Z(t)$ through \eqref{eq:mr1_reconstruction}.
Assuming the interest rate is constant $r$,
%the price of the discounted derivative contract $V(t, Z(t))$ follows the SDE:
%\begin{align}
%d\left(\frac{V}{B}\right) & = \frac{1}{B}\left(\frac{\partial V}{\partial t} dt + \frac{\partial V}{\partial Z} dZ + \frac{1}{2}\frac{\partial^2 V}{\partial Z^2} dZ^2 \right) - r\frac{V}{B}dt  \\
%   & = \frac{1}{B} \left[\left(\frac{\partial V}{\partial t} - \alpha Z\frac{\partial V}{\partial Z} + \frac{1}{2} \frac{\partial^2 V}{\partial Z^2} - rV\right)dt + \frac{\partial V}{\partial Z} dW_t \right]
%\end{align}
%For $\frac{V}{B}$ to be a martingale, 
follow the derivation of the Black-Scholes PDE in the lecture notes (through the fact that $\frac{V}{B}$ a martingale),
demonstrate that the derivative contract price $V(t, Z(t))$ has to satisfy the PDE:
\begin{align}
rV(t) = \frac{\partial V(t)}{\partial t} - \alpha Z(t) \frac{\partial V(t)}{\partial Z} + \frac{1}{2} \frac{\partial^2 V(t)}{\partial Z^2}
\end{align}


Now, develop a PDE pricer that prices a European call option on the futures contract $F(t, T)$ with strike $K$ and expiry $t_e$ using implicit Euler scheme, with $Z_t$ as state variable.
The payoff at time $t_e$ of the function is $\max(F(t_e, T) - K, 0)$.
You should describe how to set up the initial value at the terminal time step $t_e$, the boundary conditions, and implement the pricer with the below signature:
\begin{verbatim}
callOnFuturesPDE(priceCurve, alpha, sigma, rf, expiry, T, K, nT, nZ, Zmax, Zmin)
\end{verbatim}
where the nT and nZ are the number of subdivisions that divides the time axis and state variable axis in equal spaces.
\verb=Zmax= and \verb=Zmin= are the range of the state variable axis. 
The \verb=priceCurve= is the futures prices for various maturities T's observed today, i.e., $F(0, T)$.

Let us generate the price curve by linearly interpolating the below observations with flat extrapolation (i.e., \verb=@(T) interp1(delivs, prices, T, "linear", "extrap")=:
\vspace{-0.6cm}
\begin{verbatim}
  delivs = [1/12, 2/12, 3/12, 6/12, 9/12, 1, 1.5, 2, 3, 5];
  prices = [43, 45, 47, 49.05, 50.37, 51.36, 52.3, 53.51, 54.6, 55.7];
\end{verbatim}
For 
\begin{verbatim}
  alpha = 50%, sigma = 20%, rf = 5%, 
  expiry = 1, T = 2, K = 50, 
\end{verbatim}
Choose reasonable \verb=nT, nZ, Zmax, and Zmin= such that the price converges well.
Converging well here means that further increasing the density of the PDE grid or changing the cutoff points Zmin and Zmax does not change much the option price (e.g., difference $ < 10^{-4}$).
Now, use the same setting, shift the \verb=priceCurve= up and down in parallel by [-10, -9, ..., 9, 10], plot the option price versus the shift.

\subsection*{Submission Checklist}
Below is the list of required files in the submission:
\begin{itemize}
\item \verb=doc.pdf= that documents the algorithms, implementations, the required answers and charts. Only PDF format is acceptable, please do not submit any MS Word file.
\item \verb=ex1.m= that contains the functions required by assignment 2.1, and the test script that generates the charts and necessary information.
\item \verb=ex2.m= that contains the functions required by assignment 2.2, and the test script that generates the charts and necessary information.
\item \verb=ex3.m= that contains the functions required by assignment 2.3, and the test script that generates the charts and necessary information.
\end{itemize}
Readability and performance of the code might be taken into account at grading.

You do not need to create sub-folders for the questions. 
The filename of the zip file should be in the format of \verb=Ex1_name1_matricNumber1_name2_matricNumber2.zip=.
And the matric number should contain the last alphabetic letter.

\end{document}
