
\documentclass[12pt,a4paper,hidelinks,fleqn]{article}            % Article 12pt font for a4 paper while hiding links
\usepackage[margin=1in]{geometry}                          % Required to adjust margins
\input{styleAndCommands}
\title{\vspace{-5ex}Assignment 2, FE5116 (2014/2015, Semester 2)\vspace{-7ex}}
\date{}
\begin{document}
\maketitle

\subsection*{1. Numerical Derivatives}
Write a function \verb=MyFirstDeriv(f, x0, h)= to compare three methods of computing the derivative $f'(x_0)$
at point $x_0$ for a function $f(x)$ of an unknown form.
The input \verb=x0= and \verb=h= are two double variables,
and \verb=f= is a function from double to double. 

The first step of \verb=MyFirstDeriv(f, x0, h)= is to construct 5 sample points: $[f(x_0-h), f(x_0-\frac{h}{2}), f(x_0), f(x_0+\frac{h}{2}), f(x_0+h)]$, denoted as \verb=ys=.
Then, it derives the first derivative $f'(x_0)$ in three ways:

\vspace{-6mm}
\paragraph{a)} List the four taylor expansion at the four points $f(x_0-h), f(x_0-\frac{h}{2}), f(x_0+\frac{h}{2}), f(x_0+h)$, 
multiply each by coefficient $b_j$ for $j\in\{1, 2, 3, 4\}$, 
construct a linear system of $b_j$ such that the order 0, 2, and 3 disappear, and order 1 term becomes 1, 
solve for $b_i$, 
print out $b_i$,
derive the coefficients \verb=cs= such that $f'(x_0)$ = \verb=sum(cs .* ys)=,
and print out \verb=cs= and $f'(x_0)$. 
\vspace{-6mm}
\paragraph{b)} Compute $f'(x_0)$ using Richardson extrapolation with the central difference g(h) and the step sizes $h$ and $\displaystyle \frac{h}{2}$,
derived the coefficients \verb=cs= such that $f'(x_0)$ = \verb=sum(cs .* ys)=,
print out \verb=cs= and $f'(x_0)$. Compare the coefficients \verb=cs= with the coefficients derived in part \textbf{a)}.
\vspace{-6mm}
\paragraph{c)} Construct a $4^{th}$ order polynomial $p(x) = \sum_{i=0}^4 a_i x^i$ that passes through the five given points, 
compute $p'(x_0)$ analytically, 
print out the polynomial,
print out the coefficients \verb=cs= such that $p'(x_0)$ = \verb=sum(cs .* ys)=,
and print out the derivative $p'(x_0)$.
Again, compare the coefficients \verb=cs= with the coefficients derived from in \textbf{a)}.

What do you observe? The submission should contain only a single file \verb=MyFirstDeriv.m= that implements the function \verb=MyFirstDeriv(f, x0, h)=.
 
\subsection*{2. Market Implied Volatilities}

\paragraph{a)} A volatility smile for European options expired at time $T$ is a function $\sigma(K)$ from the option strike $K$ to the implied volatility $\sigma(K)$.
Normally the market does not quote the implied volatilities of all strikes.
Instead, it quotes implied volatilities only for a sample set of strikes. 
Given this sample set of market quotes, 
a market maker needs to construct an interpolator to be able to evaluation options at all strikes using Black-Scholes formula.

Now, assuming you have 5 market quotes $[(K_i, \sigma_i)]$ for $i\in\{1, 2, 3, 4, 5\}$,
construct a function 
\vspace{-0.6cm}
\begin{verbatim}
  ImpliedVol( ks, vs, strike )
    ks: the 5 strike quotes, in ascending order
    vs: the 5 implied volatility quotes corresponding to ks
    strike: the strike you want to query
\end{verbatim}
\vspace{-0.6cm}
using cubic spline interpolator provided by Octave (
\url{https://www.gnu.org/software/octave/doc/interpreter/One_002ddimensional-Interpolation.html})
for the strikes within the range of $[K_1, K_5]$. For the ranges outside, we extrapolate using $\sigma_1$ for the left wing and $\sigma_5$ for the right wing (flat wings).
The function returns a $\sigma$ for any positive input \verb=strike=.
The function should also check the validity of the inputs and throws an error for invalid input.

\paragraph{b)}
In many markets, traders do not quote options in absolute strikes. 
Instead, they quote options in \emph{delta} which gives a homogeneous representation of the moneyness of the options for various expiries $T$'s.
Let us consider a simple form of delta, "simple call delta":
\begin{align*}
\Delta_{simple} (F, T, K) = \text{normcdf}\left( \frac{\ln(F/K)}{\sigma(K) \sqrt T} \right).
\end{align*}
where $F$ is the forward at $T$. 
Write a function 
\vspace{-6mm}
\begin{verbatim}
  SimpleDelta(F, T, ks, vs, K)
\end{verbatim}
\vspace{-6mm}
that implements the above formula. The fuction $\sigma(K)$ is the one done in part \textbf{a)}. 
The function cumulative distribution function \verb=normcdf= is provided by Octave.
 
\paragraph{c)} Now, given a quote in delta, how do you convert it to the strike of the option?
Given \verb=F, T, ks, vs=, write a function that converts a simple delta point $d$, $d \in [0, 1]$ to the option strike $K$:
\begin{verbatim}
  DeltaToStrike (F, T, ks, vs, d)
\end{verbatim}
and plot the strike from 0.01 to 0.99 delta points.

(Hint: you need to use a root search method that solves for $\Delta_{simple}(K) - d = 0$ since the implied volatility is a function of $K$ as well.
The root search functions provided in the lecture material take the function $f$ with only one variable. 
Therefore you need to partially apply all the other inputs to the \verb=SimpleDelta= function you implemented and feed to root search method with $\Delta_{simple}(K)$.
Check \verb=partialapplication.m= in the lecture material on how to partially apply arguments to a function.
You can assume the input \verb=ks= and \verb=vs= are good quotes such that the $\Delta_{simple}$ function is monotonic to $K$.)


The submission should contain only 3 .m files: ImpliedVol.m, SimpleDelta.m, and DeltaToStrike.m. Each implements its corresponding function.

\subsection*{3. Option Pricing with Quadrature}
The present value of a European put option with strike at $K$ and expiry at $T$ is
\begin{align*}
P(S_0, K, T) & = e^{-rT}\E_\probQ [(K - S_T)_+]
\end{align*}
where $r$ is the risk-free rate and $\probQ$ is the risk-neutral measure.
The drift of the spot price S under $\probQ$-measure is $r$.
Under Black-Scholes assumption, $S_T$ is log-normally distributed with probability density function
\begin{align*}
pdf(S_T) = \frac{1}{\sigma S_T\sqrt{2\pi T}} \exp\left(- \frac{(\ln S_T - \ln S_0 - rT + \frac{1}{2}\sigma^2T)^2}{ 2\sigma^2 T} \right)
\end{align*}
The put price is then
\begin{align}
\label{eqn:bssolution}
  P(S_0, K, T) = e^{-rT}\int_0^K \left(K - S_T\right) pdf(S_T) dS_T 
\end{align}
Implement a function
\vspace{-6mm}
\begin{verbatim}
  PutIntegral(S, K, T, v, r, n)
    S: spot price at time 0
    K: strike
    T: time to maturity (in years)
    v: the volatility
    r: risk-free rate
    n: the number of intervals you divide the integration region 
\end{verbatim}
\vspace{-6mm}
that calculates the put price through integral \eqref{eqn:bssolution} using mid-point rule quadrature.
Note that the reason we use the mid-point rule is that the $pdf$ is undefined at the integration boundary $S_T=0$.

Implement \verb=PutIntegralS(S, K, T, v, r, n)= that uses mid-point rule for the left most interval, and Simpson rule for all the other intervals.

Plot the convergence chart (the difference between your function and the Black-Scholes analytical formula) in log scale for n from 3 to 10000, for the two functions implemented.
The Black-Scholes analytic formula is
\begin{align*}
P(S_0, K, T) = Ke^{-rT} N(-d_-) - S_0 N(-d_+)
\end{align*}
where $N(\cdot)$ is the standard cumulative normal function and is implemented as \verb=normcdf= in Octave, and
\begin{align*}
d_{\pm} = \frac{ln\frac{S_0}{K} + (r \pm \frac{1}{2}\sigma^2)T}{\sigma\sqrt{T}}.
\end{align*}

The submission should contain a single file \verb=q3.m= that can be run without any parameter. 
All the functions \verb=PutIntegral, PutIntegralS=, and the analytic formula should be inside the \verb=q3.m= file. 


\subsection*{Submission Checklist}
Below is the list of required files in the submission package:
\begin{itemize}
\item Q1: \verb=MyFirstDeriv.m=
\item Q2: \verb=ImpliedVol.m, SimpleDelta.m, DeltaToStrike.m=
\item Q3: \verb=q3.m=
\end{itemize}
You do not need to create sub-folders for the questions. 
A brief report (in PDF format) is welcome if you feel the need to explain certain functions.
To re-iterate, the filename of the zip file should be in the format of \verb=Ex2_name1_matricNumber1_name2_matricNumber2.zip=.
And the matric number should contain the last alphabetic letter if applicable. 


\end{document}
